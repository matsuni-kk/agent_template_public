---
description: "Template Agent Master Control Rules - エージェント派生の統一基盤"
globs:
---
# 00_master_rules.mdc

# ==========================================================
# 00_XXX.mdc - XXX マスタールール
# ==========================================================


path_reference: "agent_paths.mdc"
# =========================
# AI注意事項 - AIが確実に守るべき指示
# =========================
ai_instructions:
  - "すべてのルールは正確に実行し、独自の解釈で変更しないこと"
  - "execute_shellアクションのコマンドは一切変更せずそのまま実行すること"
  - "指定されたファイルパスやフォルダ構造を尊重し、勝手に構造を変更しないこと"
  - "失敗した場合でも代替手段を取らず、失敗を報告してユーザーの指示を仰ぐこと"

master_triggers:
# =========================
  # 00. Agent Initialization Phase
# =========================
  - trigger: "(Templateプロジェクト開始|Template初期化|新規Templateプロジェクト)"
    priority: high
    description: "エージェント初期化とプロジェクト構造作成"
    steps:
      - name: "start_info_collection"
        action: "call 01_template_initialization.mdc => initialization_questions"
        message: "Template初期化に必要な情報を収集します。以下の質問に回答してください。"
      - name: "wait_user_responses"
        action: "wait_for_all_answers"
        message: "必要な回答が揃うまで先に進みません。"
      - name: "confirm_project_creation"
        action: "confirm"
        message: "以下の内容でTemplateプロジェクトを初期化します：\n\nプロジェクト: {{project_id}}\n\nよろしいですか？"
      - name: "create_project_structure"
        action: "execute_shell"
        command: "mkdir -p {{patterns.project_dir}}"
        message: "プロジェクト構造を作成します..."
      - name: "create_readme"
        action: "create_markdown_file"
        path: "{{patterns.project_readme}}"
        template_reference: "01_template_initialization.mdc => project_readme_template"
        message: "プロジェクトREADMEを作成します..."
      - name: "notify_completion"
        action: "notify"
        message: |
          ✅ Templateプロジェクト「{{project_id}}」の初期化が完了しました。
          
          次のステップとしてtemplate固有の作業を開始してください。

# =========================
  # 1–N. Domain Rules (01–89)
# =========================
  # 派生時に対象ドメインの専用ルールを01-89番で定義
# =========================
# =========================
  # 98. Flow Assist (Interactive support)
# =========================
  - trigger: "(アイディア発散Template|Templateブレスト|ヒューリスティック思考Template)"
    priority: medium
    steps:
      - name: "prepare_flow_workspace"
        action: "execute_shell"
        command: "mkdir -p {{patterns.flow_day_dir}}"
        message: "本日分の Flow ワークスペースを準備します..."
      - name: "ask_brainstorm_questions"
        action: "call 98_flow_assist.mdc => brainstorm_questions"
        message: "アイデア発散セッションを開始します。テーマなどを教えてください。"
      - name: "wait_brainstorm_answers"
        action: "wait_for_all_answers"
      - name: "create_brainstorm_notes"
        action: "create_markdown_file"
        path: "{{patterns.brainstorm_notes_md}}"
        template_reference: "98_flow_assist.mdc => brainstorm_template"
        message: "アイデア発散ノートを作成しました: {{patterns.brainstorm_notes_md}}"
      - name: "notify_brainstorm_creation"
        action: "notify"
        message: "✅ アイデア発散ノートが {{patterns.brainstorm_notes_md}} に作成されました。"
# =========================
  # 99. Rule Maintenance & System Management
# =========================
  - trigger: "(ルールチェック|ルール構造チェック|ルール品質確認|RuleLint|ルール診断|ルール整合性確認|Template構造検証|rule lint|rule health check|rule audit)"
    priority: medium
    steps:
      - name: "perform_rule_lint"
        action: "call 99_rule_maintenance.mdc => rule_check_questions"
        message: "ルール整合性チェックとTemplate構造検証に必要な情報を確認します。"
      - name: "create_rule_check_report"
        action: "create_markdown_file"
        path: "{{patterns.rule_check_log}}"
        template_reference: "99_rule_maintenance.mdc => rule_check_report_template"
        message: "チェック結果レポートを {{patterns.rule_check_log}} に作成しました。"
      - name: "notify_rule_check_completion"
        action: "notify"
        message: |
          ✅ ルール整合性チェックが完了しました。
          レポート: {{patterns.rule_check_log}}
          エラーや警告がある場合は結果を確認し、必要に応じて 99_rule_maintenance.mdc の修正フローを実行してください。

  - trigger: "(ルール追加|ルール修正|ルール更新|ルール改定|ルール整備|ルール改修|ルール編集|ルール保守|ルール改善|rule maintenance|rule update|rule edit|rule add|rule improvement|ルールメンテ)"
    priority: high
    steps:
      - name: "start_message"
        action: "notify"
        message: "**ルールブラッシュアップを開始します。** 対象ルール・変更理由・paths整合について順にヒアリングします。"
      - name: "collect_info"
        action: "call 99_rule_maintenance.mdc => rule_maintenance_questions"
        message: "編集したい内容を具体的に入力してください。未決事項は保留メモとして記録します。"
      - name: "create_log"
        action: "create_markdown_file"
        path: "{{patterns.rule_maintenance_log}}"
        template_reference: "99_rule_maintenance.mdc => rule_maintenance_log_template"
        message: "Flow/agent_build ログを生成しました。検証・レビュー計画が揃っているか確認してください。"
      - name: "maybe_create_rule_skeleton"
        action: "conditional_step"
        condition: "{{operation}} == 'add'"
        true_action: "create_markdown_file: path='{{patterns.rule_skeleton_out}}' template_reference='99_rule_maintenance.mdc => rule_skeleton_template'"
        false_action: "notify: '編集モード: 既存ルールをブラッシュアップします（スケルトン生成は不要）'"
      - name: "post_creation_instruction"
        action: "notify"
        message: "**編集作業のお願い**\n- 追加の場合は {{patterns.rule_skeleton_out}} を開き、プロンプト/Phase/テンプレートなど全セクションをドメイン仕様で埋めてください。\n- 既存ルールの編集の場合は対象ファイルを更新し、変更点をログに追記してください。\n- Flow/agent_build タスクリストで、中身の埋め込みとレビュー完了にチェックを付けるまで忘れないでください。"
      - name: "completion_message"
        action: "notify"
        message: "**ルールブラッシュアップの記録が完了しました。**\n- ログ: {{patterns.rule_maintenance_log}}\n- タスクリスト: Flow/agent_build/{{meta.year_month}}/{{meta.today}}_agent_creation_tasklist.md を更新してください。"

  - trigger: "(パス更新|path更新|paths編集|パス構造変更|フォルダ構成調整|paths maintenance|path maintenance)"
    priority: high
    steps:
      - name: "start_path_review"
        action: "notify"
        message: "**パス定義の更新を開始します。** 変更したいフォルダ構造や root 設定を確認します。"
      - name: "collect_path_changes"
        action: "call 99_rule_maintenance.mdc => path_update_questions"
        message: "更新したいパス定義（{domain}_paths.mdc）と影響範囲を入力してください。"
      - name: "run_validation"
        action: "execute_shell"
        command: "python3 scripts/validate_rules.py"
        message: "最新パス定義でルールバリデーションを実行しています..."
      - name: "create_path_log"
        action: "create_markdown_file"
        path: "{{patterns.rule_check_log}}"
        template_reference: "99_rule_maintenance.mdc => path_update_report"
        message: "パス更新レポートを {{patterns.rule_check_log}} に記録しました。"
      - name: "notify_path_completion"
        action: "notify"
        message: "**パス定義の更新が完了しました。**\n- レポート: {{patterns.rule_check_log}}\n- 必要に応じて {domain}_paths.mdc と 00_master_rules.mdc の整合を再確認してください。"

# ==========================================================
# =========================
# Agent Derivation Instructions
# =========================
# ==========================================================

## LLM-Driven Agent Generation Guidelines

### 1. Template Variable Replacement
```yaml
Template     : 派生先エージェント名 (e.g., "BABOK", "Knowledge")
template         : ドメイン名 (e.g., "babok", "knowledge") 
{{specialized_rules}}: 01-89番台の専門ルール番号リスト
```

### 2. Rule Numbering Convention
- **00**: Master control rules (このファイル)
- **01-89**: Domain-specific specialized rules
- **97**: Flow to Stock rules (標準化済み)
- **98**: Flow assist / brainstorming
- **99**: Rule maintenance & system management

### 3. Standard Directory Structure
```
{agent_name}_agent/
├── Flow/           # 作業中ドラフト（日付階層で整理）
│   └── YYYYMM/
│       └── YYYYMMDD/
├── Stock/          # 確定版ドキュメント
├── Archived/       # アーカイブ
├── cursor_bank/    # ルールファイル群
└── scripts/        # 自動化スクリプト
```

### 4. Mandatory Files for Derived Agents
- `00_master_rules.mdc` (このテンプレートベース)
- `{domain}_paths.mdc` (パス定義)
- `97_flow_to_stock_rules.mdc` (Flow→Stock移動)
- `98_flow_assist.mdc` (対話支援)
- `99_rule_maintenance.mdc` (ルール保守)
- 生成済みエージェントでルール追加/編集/削除やフォルダ構成の調整を行う際は、00_master_rules.mdc と {domain}_paths.mdc の更新内容が漏れないよう 99_rule_maintenance.mdc のチェックリスト・ログテンプレートを必ず整備し、変更を追跡できる状態を維持する。
