---
description: Chrome拡張機能プロジェクト初期化システム
globs:
alwaysApply: false
---
# ==========================================================
# 01_chrome_extension_initialization.mdc - プロジェクト初期化
# ==========================================================

path_reference: "chrome_extension_paths.mdc"

# ======== プロンプト（目的と使い方） ========
prompt_purpose: |
  Chrome拡張機能開発者が新規プロジェクトを開始する際に、Manifest V3準拠の標準フォルダ構造とFlow/Stock/Archivedディレクトリを自動生成し、開発基盤を整備します。

prompt_why_questions: |
  プロジェクト名、拡張機能の目的、必要なコンポーネント（popup/background/content script）、権限要件を収集することで、適切なプロジェクト構成とmanifest.jsonの初期設定を決定します。

prompt_why_templates: |
  標準化されたフォルダ構造とREADME、開発ガイドラインを提供することで、Chrome拡張のベストプラクティスに準拠した開発環境を即座に構築できます。

prompt_principles: |
  - Manifest V3標準に準拠したフォルダ構造を提供
  - 不足情報は「未記載」として明示し、後続工程で補完
  - 生成されたフォルダパスとファイル名を記録し、検証可能にする
  - サンプル拡張機能の参照元URL・取得日時を明記

# ======== Chrome拡張プロジェクト初期化システム統合エージェント ========

system_capabilities:
  folder_structure_generation: "Manifest V3準拠の標準フォルダ構造（src/css, src/html, src/js, src/images, src/libs）を自動生成し、各ディレクトリの役割を明確化"
  flow_stock_setup: "Flow/Stock/Archivedディレクトリを初期化し、ドラフト管理と確定版ドキュメント管理の基盤を整備"
  project_documentation: "プロジェクトREADME、開発ガイドライン、構造説明を含む初期ドキュメントセットを生成"
  manifest_scaffold: "基本的なmanifest.jsonスケルトン（V3準拠）を配置し、プロジェクト要件に応じた初期設定を提供"
  component_detection: "必要なコンポーネント（popup, background, content script, options）を特定し、対応するファイルとフォルダを準備"
  validation_setup: "バリデーションスクリプトとチェックリストを配置し、継続的な品質確認の仕組みを構築"

# ======== Phase 1: 要件収集フェーズ ========

phase_1_description: |
  プロジェクト名、拡張機能の目的、対象ユーザー、必要な機能コンポーネント、権限要件を質問形式で収集します。
  Flow/Stock/Archivedの初期構成についてユーザーに説明し、承認を得ます。
  サンプル拡張機能を参照する場合は、そのURL・リポジトリ名・取得日時を記録します。

# ======== Phase 2: 初期化実行フェーズ ========

phase_2_description: |
  収集した要件に基づき、標準フォルダ構造とFlow/Stock/Archivedディレクトリを作成します。
  manifest.jsonスケルトン、README.md、開発ガイドラインを配置し、プロジェクト初期化を完了します。
  生成されたフォルダパスとファイル一覧をFlow側のログに記録し、タスクリストを初期化します。

# ======== 統合オプション質問 ========

project_init_questions:
  - key: "project_name"
    prompt: "プロジェクト名（Chrome拡張機能の名称）を入力してください："
    type: "text"
    required: true
    placeholder: "例: MyAwesomeExtension"

  - key: "extension_purpose"
    prompt: "この拡張機能の目的・概要を簡潔に説明してください："
    type: "multiline"
    required: true
    placeholder: "例: Webページの特定要素を自動的にハイライトし、ユーザーの閲覧体験を向上させる"

  - key: "target_users"
    prompt: "想定ユーザー（誰がこの拡張機能を使用しますか？）："
    type: "text"
    required: false
    placeholder: "例: Webデザイナー、開発者、一般ユーザー"

  - key: "required_components"
    prompt: "必要なコンポーネントを選択してください（カンマ区切りで複数選択可）:\n- popup: ポップアップUI\n- background: バックグラウンドサービスワーカー\n- content: コンテンツスクリプト\n- options: オプションページ"
    type: "text"
    required: true
    placeholder: "例: popup,background,content"

  - key: "required_permissions"
    prompt: "必要な権限を選択してください（カンマ区切り）:\n例: activeTab, storage, tabs, notifications, scripting"
    type: "text"
    required: false
    placeholder: "例: activeTab,storage"

  - key: "sample_extension_reference"
    prompt: "参照するサンプル拡張機能のURL・リポジトリがあれば入力してください（任意）："
    type: "text"
    required: false
    placeholder: "例: https://github.com/example/sample-extension"

  - key: "use_typescript"
    prompt: "TypeScriptを使用しますか？ (yes/no)"
    type: "text"
    required: false
    placeholder: "例: no"

  - key: "flow_stock_approval"
    prompt: "Flow/Stock/Archivedの初期構成で進めてよろしいですか？ (yes/no)\n- Flow: 作業中ドラフト（日付管理）\n- Stock: 確定版成果物\n- Archived: アーカイブ"
    type: "text"
    required: true
    placeholder: "yes"

# ======== プロジェクト初期化プロセス ========

initialization_steps:
  1_folder_structure_creation:
    name: "標準フォルダ構造生成"
    phases:
      - "ルートディレクトリに manifest.json, package.json, README.md を配置"
      - "/src ディレクトリを作成し、css, html, js, images, libs サブフォルダを生成"
      - "/build ディレクトリ（ビルド成果物格納用）を作成"
      - "Flow/{{meta.year_month}}/{{meta.today}}/{{meta.agent_dir}} ディレクトリを作成"
      - "Stock/programs/{{project}}/documents, Stock/programs/{{project}}/images を作成"
      - "Archived/keep ディレクトリを作成"
    quality_standards:
      - "Manifest V3標準構造に完全準拠"
      - "全ディレクトリに .gitkeep または説明ファイルを配置"
      - "生成されたフォルダパスをログに記録"

  2_manifest_scaffold:
    name: "manifest.jsonスケルトン配置"
    phases:
      - "manifest_version: 3 を明示"
      - "name, version, description を質問回答から設定"
      - "required_permissions を permissions フィールドに反映"
      - "required_components に応じて action/background/content_scripts セクションを追加"
      - "icons フィールドに標準サイズ（16, 48, 128）のプレースホルダを配置"
    integration_points:
      - "02_chrome_extension_manifest.mdc で詳細設定を実施"
      - "生成されたmanifest.jsonはFlow側にドラフトとして保存"

  3_initial_documentation:
    name: "初期ドキュメント生成"
    phases:
      - "README.md にプロジェクト概要、フォルダ構造、開発手順を記載"
      - "Flow/{{meta.year_month}}/{{meta.today}}/{{meta.agent_dir}}/draft_project_plan.md を作成"
      - "開発ガイドライン（.cursor/templates/dev_guidelines.md）を配置"
      - "タスクリスト（Flow/{{meta.year_month}}/{{meta.today}}/{{meta.agent_dir}}/tasklist.md）を初期化"
    automation_features:
      - "サンプル拡張参照URLがある場合はREADMEに記載"
      - "取得日時と参照目的を明記"

# ======== プロジェクト初期化ワークフロー ========

initialization_workflow:
  phase_1:
    - name: "要件収集"
      action: "call 01_chrome_extension_initialization.mdc => project_init_questions"
      description: "プロジェクト基本情報とコンポーネント要件を質問形式で収集"
      mandatory: true

    - name: "Flow/Stock/Archived承認確認"
      action: "validate_input"
      description: "flow_stock_approval が 'yes' であることを確認し、未承認なら処理中断"
      mandatory: true

  phase_2:
    - name: "フォルダ構造生成"
      action: "execute_shell"
      description: "標準フォルダ構造とFlow/Stock/Archivedディレクトリを一括作成"
      mandatory: true

    - name: "manifest.jsonスケルトン配置"
      action: "create_file"
      description: "Manifest V3準拠の基本manifest.jsonをルートに配置"
      mandatory: true

    - name: "初期ドキュメント生成"
      action: "create_markdown_file"
      description: "README.md, draft_project_plan.md, タスクリストを作成"
      mandatory: true

# ======== テンプレート ========

project_readme_template: |
  # {{project_name}} - Chrome Extension

  ## 概要
  {{extension_purpose}}

  ## ターゲットユーザー
  {{target_users}}

  ## プロジェクト構造

  ```
  /
  ├── manifest.json          # Manifest V3設定ファイル
  ├── package.json           # プロジェクト依存関係
  ├── README.md              # このファイル
  ├── /src
  │   ├── /css               # スタイルシート
  │   ├── /html              # HTMLファイル（popup.html, options.html等）
  │   ├── /js                # JavaScriptモジュール
  │   │   ├── popup.js       # Popup制御スクリプト
  │   │   ├── background.js  # Service Worker (Manifest V3)
  │   │   └── content.js     # Content Script
  │   ├── /images            # アイコン・画像リソース
  │   └── /libs              # サードパーティライブラリ
  ├── /build                 # ビルド成果物（.crx等）
  ├── Flow/                  # 作業中ドラフト（日付管理）
  ├── Stock/                 # 確定版ドキュメント
  └── Archived/              # アーカイブ
  ```

  ## 必要なコンポーネント
  {{required_components}}

  ## 必要な権限
  {{required_permissions}}

  ## 参照サンプル
  {{#if sample_extension_reference}}
  - URL: {{sample_extension_reference}}
  - 取得日時: {{meta.timestamp}}
  {{else}}
  未記載
  {{/if}}

  ## 開発手順

  1. **プロジェクト初期化**: このREADMEが配置された段階で完了
  2. **Manifest設定**: `02_chrome_extension_manifest` ルールでmanifest.jsonを詳細設定
  3. **コンポーネント実装**: popup/background/content scriptを各ルールで実装
  4. **バリデーション**: `06_chrome_extension_validation` でManifest V3準拠を確認
  5. **テスト**: `07_chrome_extension_testing` でChrome開発者モードで読み込みテスト
  6. **パッケージング**: .crxファイルを生成し、Chrome Web Store公開準備

  ## TypeScript使用
  {{use_typescript}}

  ---
  **作成日時**: {{meta.timestamp}}
  **エージェント**: ChromeExtensionAgent
  **Manifest Version**: 3

project_plan_template: |
  # {{project_name}} - プロジェクト計画

  ## プロジェクト概要
  - **プロジェクト名**: {{project_name}}
  - **目的**: {{extension_purpose}}
  - **ターゲットユーザー**: {{target_users}}
  - **作成日**: {{meta.timestamp}}

  ## 成功基準
  - [ ] Manifest V3準拠のmanifest.json生成
  - [ ] 必要なコンポーネント（{{required_components}}）の実装完了
  - [ ] バリデーションエラーゼロ
  - [ ] Chrome開発者モードで正常動作確認

  ## 開発フェーズ

  ### Phase 1: 初期化（完了）
  - [x] フォルダ構造生成
  - [x] README.md作成
  - [x] manifest.jsonスケルトン配置
  - [x] Flow/Stock/Archived初期化

  ### Phase 2: Manifest設定
  - [ ] manifest.jsonの詳細設定
  - [ ] 権限設定の最終確認
  - [ ] アイコン配置

  ### Phase 3: コンポーネント実装
  - [ ] Popup UI実装
  - [ ] Background Service Worker実装
  - [ ] Content Script実装
  - [ ] Options Page実装（必要に応じて）

  ### Phase 4: バリデーション・テスト
  - [ ] Manifest V3バリデーション
  - [ ] Chrome開発者モードで読み込み
  - [ ] 機能テスト実施
  - [ ] エラー修正

  ### Phase 5: 完成・公開準備
  - [ ] .crxパッケージング
  - [ ] Chrome Web Store公開準備
  - [ ] ドキュメント最終化

  ## 参照リソース
  {{#if sample_extension_reference}}
  - サンプル拡張: {{sample_extension_reference}}
  - 取得日時: {{meta.timestamp}}
  {{else}}
  未記載
  {{/if}}

  ## 未決事項・TODO
  - [ ] アイコンデザイン確定
  - [ ] 詳細な機能仕様の策定
  - [ ] テストシナリオ作成

  ---
  **保存先**: Flow/{{meta.year_month}}/{{meta.today}}/{{meta.agent_dir}}/draft_project_plan.md

manifest_skeleton_template: |
  {
    "manifest_version": 3,
    "name": "{{project_name}}",
    "version": "1.0.0",
    "description": "{{extension_purpose}}",
    "permissions": [{{#if required_permissions}}{{required_permissions}}{{else}}"activeTab"{{/if}}],
    "icons": {
      "16": "src/images/icon16.png",
      "48": "src/images/icon48.png",
      "128": "src/images/icon128.png"
    }{{#if required_components.includes('popup')}},
    "action": {
      "default_popup": "src/html/popup.html",
      "default_icon": {
        "16": "src/images/icon16.png",
        "48": "src/images/icon48.png",
        "128": "src/images/icon128.png"
      }
    }{{/if}}{{#if required_components.includes('background')}},
    "background": {
      "service_worker": "src/js/background.js"
    }{{/if}}{{#if required_components.includes('content')}},
    "content_scripts": [
      {
        "matches": ["<all_urls>"],
        "js": ["src/js/content.js"]
      }
    ]{{/if}}
  }

# ======== エラーハンドリング ========

error_handling:
  missing_flow_stock_approval:
    message: "Flow/Stock/Archivedの初期構成が承認されていません。flow_stock_approval に 'yes' を指定してください。"
    recovery_actions:
      - "ユーザーに再度確認し、承認を得る"
      - "承認が得られない場合は処理を中断し、別構成案を提示"

  invalid_component_selection:
    message: "required_componentsに無効な値が含まれています。popup, background, content, options のいずれかを指定してください。"
    recovery_actions:
      - "有効なコンポーネント名のリストを再提示"
      - "デフォルトで popup,background,content を設定"

  folder_creation_failure:
    message: "フォルダ構造の作成に失敗しました。権限またはパスを確認してください。"
    recovery_actions:
      - "エラーログをFlow側に記録"
      - "ユーザーに手動でのフォルダ作成を依頼"

# ======== 設定 ========

initialization_settings:
  default_manifest_version: 3
  default_version: "1.0.0"
  default_permissions: ["activeTab", "storage"]
  create_gitkeep: true
  log_generated_paths: true

# ======== 統合ポイント ========

integration_points:
  manifest_customization:
    trigger: "初期化完了後"
    action: "call 02_chrome_extension_manifest.mdc"

  component_implementation:
    trigger: "manifest確定後"
    action: "call 03_chrome_extension_popup.mdc / 04_chrome_extension_background.mdc / 05_chrome_extension_content.mdc"

  validation:
    trigger: "実装完了後"
    action: "call 06_chrome_extension_validation.mdc"

# ======== 品質保証 ========

quality_assurance:
  mandatory_checks:
    - "manifest.json が Manifest V3 仕様に準拠していること"
    - "全必須フォルダが作成されていること"
    - "README.md にプロジェクト構造が記載されていること"
    - "Flow/Stock/Archivedディレクトリが存在すること"
    - "生成されたファイルパスがタスクリストに記録されていること"

# ======== 成功メトリクス ========

success_metrics:
  - "フォルダ生成時間 < 5秒"
  - "manifest.jsonバリデーションエラー = 0"
  - "README.md生成完了率 = 100%"
  - "Flow/Stock/Archived承認率 = 100%"
